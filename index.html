<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Parking System</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateSlotUI(slotId, data) {
      const card = document.getElementById(slotId);
      if (!card) return;

      const isOccupied = data.occupied || data.status === "booked";
      card.className = `slot-card ${isOccupied ? "occupied" : "available"}`;
      
      card.querySelector(".status").textContent = isOccupied ? 
        (data.status === "booked" ? `Booked: ${data.vehicle}` : "Occupied") : 
        "Available";
      
      // Update timers
      if (data.occupied && data.detectionTime) {
        const duration = Math.floor((Date.now() - data.detectionTime) / 1000);
        card.querySelector(".occupancy-timer").textContent = `Occupied: ${formatDuration(duration)}`;
      } else if (data.lastDuration) {
        card.querySelector(".occupancy-timer").textContent = `Last: ${formatDuration(data.lastDuration)}`;
      } else {
        card.querySelector(".occupancy-timer").textContent = "";
      }
    }

    function initSlots() {
      for (let i = 1; i <= 5; i++) {
        const slotRef = ref(db, `slots/slot${i}`);
        onValue(slotRef, (snapshot) => {
          updateSlotUI(`slot${i}`, snapshot.val() || {});
        });
      }
    }

    window.onload = initSlots;
  </script>
</head>
<body>
  <header>
    <h1>Smart Parking System</h1>
    <p>Real-time monitoring with ESP32</p>
  </header>

  <main class="parking-grid">
    <!-- Generate slots 1 through 5 -->
    <template id="slot-template">
      <div class="slot-card" id="slotX">
        <h2>Slot X</h2>
        <p class="status">Available</p>
        <p class="occupancy-timer"></p>
      </div>
    </template>
  </main>

  <footer>
    <p>Â© 2024 Smart Parking System</p>
    <p class="connection-status">Status: <span id="status-indicator">Connecting...</span></p>
  </footer>

  <script>
    // Generate slots dynamically
    const template = document.getElementById('slot-template');
    const grid = document.querySelector('.parking-grid');
    
    for (let i = 1; i <= 5; i++) {
      const slot = template.content.cloneNode(true);
      slot.querySelector('.slot-card').id = `slot${i}`;
      slot.querySelector('h2').textContent = `Slot ${i}`;
      grid.appendChild(slot);
    }
  </script>
</body>
</html>
