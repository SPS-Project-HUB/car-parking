<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Car Parking System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    #slots-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }
    .slot-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 220px;
      padding: 15px;
      text-align: center;
    }
    .slot-card h3 {
      margin-top: 0;
    }
    .status {
      font-weight: bold;
      margin: 10px 0;
    }
    .status span {
      color: green;
    }
    .status.booked span {
      color: red;
    }
    button {
      padding: 8px 14px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background: gray;
      cursor: not-allowed;
    }
    .timer {
      margin-top: 8px;
      font-size: 14px;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>Smart Car Parking System</h1>
  <div id="slots-container"></div>

  <!-- Firebase SDK and App Code -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // âœ… Your Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCSNW4PZkfse5G-s4j9HxtJqkYxuTUFQAo",
      authDomain: "carparkingsystem-e96a9.firebaseapp.com",
      databaseURL: "https://carparkingsystem-e96a9-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "carparkingsystem-e96a9",
      storageBucket: "carparkingsystem-e96a9.firebasestorage.app",
      messagingSenderId: "1074868104297",
      appId: "1:1074868104297:web:a00c054483ff39f36506f8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const container = document.getElementById("slots-container");
    const slots = ["slot1", "slot2", "slot3", "slot4", "slot5"];
    const timers = {};

    function renderSlots(data) {
      container.innerHTML = "";

      slots.forEach(slot => {
        const slotData = data[slot] || { status: "available", startTime: null };
        const status = slotData.status;
        const startTime = slotData.startTime;
        const isBooked = status === "booked";

        const card = document.createElement("div");
        card.className = "slot-card";

        card.innerHTML = `
          <h3>${slot.toUpperCase()}</h3>
          <div class="status ${isBooked ? 'booked' : ''}">
            Status: <span>${status}</span>
          </div>
          <button ${isBooked ? 'disabled' : ''} onclick="bookSlot('${slot}')">Pre-Book</button>
          <div class="timer" id="${slot}-timer">${isBooked ? "Loading..." : ""}</div>
        `;

        container.appendChild(card);

        if (isBooked && startTime) {
          startTimer(slot, startTime);
        } else {
          clearInterval(timers[slot]);
        }
      });
    }

    // Timer function
    function startTimer(slot, startTime) {
      const timerDiv = document.getElementById(`${slot}-timer`);
      if (timers[slot]) clearInterval(timers[slot]);

      timers[slot] = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const mins = Math.floor(elapsed / 60);
        const secs = elapsed % 60;
        timerDiv.textContent = `Time: ${mins}m ${secs}s`;
      }, 1000);
    }

    // Booking function
    window.bookSlot = function(slot) {
      const updates = {};
      updates[`slots/${slot}`] = {
        status: "booked",
        startTime: Date.now()
      };
      update(ref(db), updates);
    };

    // Listen to slot status in real time
    onValue(ref(db, "slots"), (snapshot) => {
      const data = snapshot.val() || {};
      renderSlots(data);
    });
  </script>
</body>
</html>
