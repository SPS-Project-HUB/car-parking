<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Car Parking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCSNW4PZkfse5G-s4j9HxtJqkYxuTUFQAo",
      authDomain: "carparkingsystem-e96a9.firebaseapp.com",
      databaseURL: "https://carparkingsystem-e96a9-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "carparkingsystem-e96a9",
      storageBucket: "carparkingsystem-e96a9.appspot.com",
      messagingSenderId: "1074868104297",
      appId: "1:1074868104297:web:a00c054483ff39f36506f8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function startTimer(slotId, startTime) {
      const timerEl = document.getElementById(`timer-${slotId}`);
      function updateTimer() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const mins = Math.floor(elapsed / 60);
        const secs = elapsed % 60;
        timerEl.textContent = `${mins}m ${secs}s`;
      }
      updateTimer();
      setInterval(updateTimer, 1000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const slots = ['slot1', 'slot2', 'slot3', 'slot4', 'slot5'];
      slots.forEach(slotId => {
        const statusRef = ref(db, `slots/${slotId}`);
        onValue(statusRef, snapshot => {
          const data = snapshot.val();
          const card = document.getElementById(slotId);
          const bookBtn = document.getElementById(`book-${slotId}`);
          const input = document.getElementById(`vehicle-${slotId}`);
          const timer = document.getElementById(`timer-${slotId}`);
          if (data) {
            card.className = data.status === "booked" ? "bg-yellow-300" : data.status === "occupied" ? "bg-red-400" : "bg-green-300";
            if (data.status === "booked" && data.startTime) {
              startTimer(slotId, data.startTime);
            }
            if (data.vehicle) {
              input.value = data.vehicle;
              input.disabled = true;
            }
            bookBtn.disabled = data.status !== "available";
          } else {
            card.className = "bg-green-300";
            input.value = "";
            input.disabled = false;
            bookBtn.disabled = false;
          }
        });
      });
    });

    window.bookSlot = function (slotId) {
      const vehicle = document.getElementById(`vehicle-${slotId}`).value.trim();
      if (!vehicle) {
        alert("Please enter your vehicle number.");
        return;
      }
      const slotRef = ref(db, `slots/${slotId}`);
      set(slotRef, {
        status: "booked",
        vehicle: vehicle,
        startTime: Date.now()
      });
    }
  </script>
</head>

<body class="bg-gradient-to-r from-blue-100 to-purple-200 min-h-screen p-6 font-sans">
  <h1 class="text-4xl font-bold text-center mb-8 text-gray-800 drop-shadow">üöò Smart Car Parking System</h1>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
    <!-- Slot Card Template -->
    <!-- Repeat this block for 5 slots -->
    ${[1, 2, 3, 4, 5].map(i => `
      <div id="slot${i}" class="rounded-xl p-6 shadow-xl bg-green-300 transition-all duration-300">
        <h2 class="text-xl font-semibold text-gray-800 mb-2">Slot ${i}</h2>
        <input id="vehicle-slot${i}" type="text" placeholder="Enter vehicle number"
               class="w-full px-3 py-2 rounded-md border border-gray-400 mb-3 text-black focus:ring focus:ring-indigo-200">
        <button id="book-slot${i}" onclick="bookSlot('slot${i}')"
                class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-800 transition">Pre-Book</button>
        <p class="mt-4 text-sm text-gray-700">‚è± <span id="timer-slot${i}">Not started</span></p>
      </div>
    `).join('')}
  </div>

  <footer class="mt-12 text-center text-gray-500 text-sm">
    Developed by <a href="https://github.com/sps-project-hub" class="text-blue-600 hover:underline">SPS Project Hub</a> üöÄ
  </footer>
</body>
</html>
