const updateUI = () => {
  slots.forEach(slot => {
    const slotRef = ref(db, "slots/" + slot);
    onValue(slotRef, (snapshot) => {
      const data = snapshot.val();
      const card = document.getElementById(slot);
      const btn = card.querySelector("button");
      const timer = card.querySelector(".timer");
      const info = card.querySelector(".info");
      
      if (data && data.occupied) {
        // IR sensor detected vehicle
        card.classList.remove("available");
        card.classList.add("booked");
        btn.disabled = true;
        info.innerText = "Occupied (IR Sensor)";
        
        if (data.detectionTime) {
          const start = data.detectionTime;
          const intervalId = setInterval(() => {
            if (!data.occupied) {
              clearInterval(intervalId);
              return;
            }
            const now = Date.now();
            const diff = Math.floor((now - start) / 1000);
            const mins = Math.floor(diff / 60);
            const secs = diff % 60;
            timer.innerText = `‚è± ${mins}m ${secs}s`;
          }, 1000);
        }
      } else {
        // Slot is free
        card.classList.remove("booked");
        card.classList.add("available");
        btn.disabled = false;
        info.innerText = "Available";
        timer.innerText = data.lastDuration ? 
          `Last stay: ${Math.floor(data.lastDuration/60)}m ${data.lastDuration%60}s` : "";
      }
    });
  });
};
